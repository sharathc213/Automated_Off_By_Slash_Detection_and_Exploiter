

<main id="main" class="main">

    <div class="pagetitle">
      <h1>Accordion</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/Dashboard">Home</a></li>
          <li class="breadcrumb-item">Scan History</li>
   
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section">
      <div class="row">
        

        <div class="col-lg-12">

          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Scan History</h5>

         
              <div class="accordion accordion-flush history" id="accordionFlushExample">

              
         
              </div>

            </div>
          </div>

        </div>
      </div>
    </section>
    <script>
      function escapeHtml(unsafe) {
    return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
}
      $(document).ready(function () {
          // Make an AJAX request to the Django view to get the list of files and their content
          $.ajax({
              url: '/get_file_list', // Replace with the URL of your Django view that returns the list of files and their content
              type: 'GET',
              dataType: 'json',
              success: function (data) {
                  // Assuming the server returns a JSON object with 'files' key
                  var files = data.files;
  
                  // Loop through the files and create an accordion item for each file
                  var accordion = $("#accordionFlushExample");
                  $.each(files, function (index, fileData) {
                      // Create accordion item
                      var accordionItem = $("<div>").addClass("accordion-item");
  
                      // Create accordion header
                      var accordionHeader = $("<h2>").addClass("accordion-header").attr("id", "flush-heading-" + index);
                      var accordionButton = $("<button>").addClass("accordion-button collapsed").attr({
                          "type": "button",
                          "data-bs-toggle": "collapse",
                          "data-bs-target": "#flush-collapse-" + index,
                          "aria-expanded": "false",
                          "aria-controls": "flush-collapse-" + index
                      }).text(fileData.filename);
  
                      accordionHeader.append(accordionButton);
                      accordionItem.append(accordionHeader);
  
                      // Create accordion body
                      var accordionBody = $("<div>").addClass("accordion-collapse collapse").attr({
                          "id": "flush-collapse-" + index,
                          "aria-labelledby": "flush-heading-" + index,
                          "data-bs-parent": "#accordionFlushExample"
                      });
  
                      // Create a list to display the scan settings
                      var scanSettingsList = $("<ul>");
                      $.each(fileData.content.scan_setting, function (key, value) {
                          var listItem = $("<li>").text(key + ": " + value);
                          scanSettingsList.append(listItem);
                      });
                      accordionBody.append($("<h4>").text("Scan Settings:"));
                      accordionBody.append(scanSettingsList);
  
                      // Divide the results into two sections: robot.txt and scan
                      var robotResults = [];
                      var scanResults = [];
                      $.each(fileData.content.result, function (index, resultItem) {
                         
                              scanResults.push(resultItem);
                     
                      });
  
                      // Create a list to display robot.txt results
                      var robotResultList = $("<ul>");
                      $.each(robotResults, function (index, robotResultItem) {
                          // var listItem = $("<li>");
                          // var resultDetailsList = $("<ul>");
                            robotResultList.append($("<li>").text("found: " + robotResultItem.found));
                              robotResultList.append($("<li>").text("content: " + robotResultItem.content));
                          // listItem.append(resultDetailsList);
                          // robotResultList.append(listItem);
                      });
                      // accordionBody.append($("<h4>").text("robot.txt:"));
                      accordionBody.append(robotResultList);
  
                      // Create a list to display scan results
                      var scanResultList = $("<ul>");
                      $.each(scanResults, function (index, scanResultItem) {
                          // var listItem = $("<li>");
                          // var resultDetailsList = $("<ul>");
                            if(scanResultItem.response==200){
                            scanResultList.append($("<li>").html('<a style="color:green" href="'+scanResultItem.link+'">'+scanResultItem.link+'</a> -----> '+escapeHtml(scanResultItem.payload)));
                            }else{
                              scanResultList.append($("<li>").html('<a style="color:orange" href="'+scanResultItem.link+'">'+scanResultItem.link+'</a> -----> '+escapeHtml(scanResultItem.payload)));
                            }
                          // listItem.append(resultDetailsList);
                          // scanResultList.append(resultDetailsList);
                      });
                      accordionBody.append($("<h4>").text("scan:"));
                      accordionBody.append(scanResultList);
  
                      accordionItem.append(accordionBody);
  
                      // Append the accordion item to the accordion
                      accordion.append(accordionItem);
                  });
              },
              error: function (xhr, textStatus, errorThrown) {
                  console.log('Error: ' + textStatus);
              }
          });
      });
  </script>
  
  
  
  
  
  </main><!-- End #main -->
